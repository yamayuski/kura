# Kura サービス要求定義

## サービス概要

Kura は、団体やグループのプライベートデータを自社管理のもとで LLM と協調する形で保存・整理・検索できるモダンな Pukiwiki サービスです。

### 主な特徴

- **データ所有権の確保**: データはすべて自社が管理
- **LLM との連携**: LLM の検索機能を活用した横断検索
- **シンプルな運用**: docker-compose でのセルフホスト対応

---

## 5W1H 要求定義

### Who（対象ユーザー）

**対象**: 特定の団体やグループの全メンバー

- 技術者から非技術者まで対応
- ユーザーグループの属性に応じたアクセス制御が可能

### What（提供サービス）

**概要**: 団体やグループのプライベートなデータを LLM と協調する形で保存・整理し、LLM の検索機能を活用して横断的に検索できるサービス

**提供価値**:

1. プライベートデータの安全な一元管理
2. 効率的な情報検索と再利用
3. 自社データへのフルコントロール

### When（利用シーン）

**主な利用場面**:

- 企業やグループのプロジェクト管理時
- チーム内での情報共有と協働
- 安全なセルフホスト環境でのデータ保存・読み書き

**背景**: 人間が書いたデータ（相対的に LLM が書いたソースコードやドキュメントよりも価値が高い）を安全に保存し、プロジェクトごとにスムーズな情報交換を実現

### Where（利用環境）

**デプロイ対象**:

| 環境 | 対応状況 | 備考 |
| --- | --- | --- |
| ローカル開発 | ✅ | docker-compose で十分 |
| オンプレミス | ✅ | docker-compose + Let's Encrypt 構成 |
| クラウド（AWS等） | ✅ | S3/DynamoDB など、データ所有権が確保できるサービスを利用 |

### Why（背景・課題解決）

**課題**: 現状の課題構造

1. **データ人質化リスク**
   - Slack、Notion、Confluence といったサードパーティのサーバにデータを置くことは、イコール企業がそのベンダーにデータを人質にとられるリスク

2. **コスト負担**
   - Slack AI や Notion AI などの LLM 機能を利用する場合、追加で料金を支払う必要がある

**Kura による解決**:

- 自社でデータを完全に管理
- LLM の利用料金のみで実現可能
- ベンダーロックインの回避

### How（実現方法・技術スタック）

**選定技術**:

| レイヤー | 技術スタック |
| --- | --- |
| **ランタイム** | Bun |
| **言語** | TypeScript |
| **バックエンド** | Hono（軽量 Web フレームワーク） |
| **ORM** | Prisma（PostgreSQL アダプタ） |
| **フロントエンド** | React |
| **スタイリング** | Tailwindcss + Kuma UI |
| **デプロイ** | Bun HTTP サーバ |

**設計思想**:

- シンプルな bun HTTP サーバとして機能
- データベースは PostgreSQL
- 標準的で保守性の高いスタックの選定

---

## 機能要件

### Must Have（必須機能）

実装必須の機能。これらがなければサービスは成立しません。

| # | 機能 | 説明 | 優先度 |
| --- | --- | --- | --- |
| 1 | Markdown データ書き込み | 行単位でレンダリングされ、自動的にコミットされる。ユーザーが新しい行を追加できる | **必須** |
| 2 | インラインエディタ | 編集モードは存在せず、ユーザーがカーソルを置いた時点でその行が編集モードに移行。確定時に自動保存・コミット | **必須** |
| 3 | メニューバー検索 | 検索欄から自由にキーワード検索が可能。結果は横断的に表示 | **必須** |
| 4 | Markdown ツリー形式保存 | Markdown はツリー構造で保存。ディレクトリ階層のように表現 | **必須** |
| 5 | アクセス制御・認可 | ツリーごとに読み書き権限を設定可能（例：001_ProjectA は ProjectA メンバーのみ閲覧・編集可能） | **必須** |
| 6 | Google Workspace OIDC ログイン | Google Workspace を使用した認証・ログイン機能 | **必須** |

### Should Have（将来実装推奨）

実装を推奨するが、初期リリースでは不要な機能。

| # | 機能 | 説明 | 想定時期 |
| --- | --- | --- | --- |
| 1 | LLM を活用した検索 | Google、Copilot、Gemini、Claude、ollama など任意の LLM Agent による検索機能 | **フェーズ 2** |

### Nice to Have（将来検討）

実装できれば便利だが、優先度は低い機能。

| # | 機能 | 説明 |
| --- | --- | --- |
| 1 | ゴースト表示（幽霊表示） | 行を編集中の一時的なコラボレーション機能。他のユーザーが編集を試行錯誤している最中に、どこにカーソルを置いていて、何をタイプしているかを半透明的に表示 |
| 2 | 追加の外部認証連携 | Google Workspace 以外の認証サービス対応（Okta、Azure AD 等） |
| 3 | コメント・議論機能 | ドキュメント内での議論・コラボレーション機能 |

---

## 非機能要件

### デプロイ・運用性

| 項目 | 要件 | 備考 |
| --- | --- | --- |
| **ローカル開発環境** | docker-compose で動作 | シンプルなセットアップ |
| **オンプレミスデプロイ** | docker-compose + Let's Encrypt で対応 | SSL/TLS 通信対応 |
| **クラウドデプロイ** | AWS など、データ所有権が確保できるクラウドに対応 | S3、DynamoDB など |
| **運用シンプル性** | 複雑な構成を避ける | 運用負担を最小化 |

### パフォーマンス・スケーラビリティ

| 項目 | 要件 | 備考 |
| --- | --- | --- |
| **スケーラビリティ** | 従業員数に応じた水平スケーリングに対応 | 組織規模の成長に柔軟に対応 |
| **応答性** | UI の応答が素早いこと | ユーザー体験の向上 |

### セキュリティ・信頼性

| 項目 | 要件 | 備考 |
| --- | --- | --- |
| **データバックアップ** | クラウド環境ではデータを厳重にバックアップ | 事業継続性の確保 |
| **アクセス制御** | ツリー/プロジェクト単位でのアクセス制御 | 情報セキュリティ |
| **SSL/TLS 通信** | すべての通信を暗号化 | 通信セキュリティ |

---

## スコープ

### ✅ 実装対象（Phase 1）

- Markdown 読み書き機能
- インラインエディタ
- メニューバー検索（キーワード検索）
- ツリー形式データ保存
- ツリーごとのアクセス制御
- Google Workspace OIDC ログイン

### 🔄 後期実装対象（Phase 2）

- LLM を活用した検索機能
- 追加の外部認証連携

### ❌ スコープ外

- その他の複雑な認証メカニズム
- **真のリアルタイムコラボレーション編集**: 複数人が同一行を同時編集し、競合を自動解決する Operational Transform や CRDT などの技術
  - 補足: 行単位でコミットするという仕様のため、ゴースト表示機能（Nice to Have #1）による一時的なコラボ表示は可能だが、永続的な複数同時編集への対応は計画外

---

## 参考情報

### 対象 LLM エージェント

以下の LLM・LLM Agent に統合可能な設計を目指します：

- ollama（オンプレミス実行）
- OpenAI Copilot
- Google Gemini
- Anthropic Claude
- その他の LLM API

### 実装計画の詳細

詳細な実装計画は、別途プロジェクト管理ドキュメント（開発ロードマップ等）を参照してください。
